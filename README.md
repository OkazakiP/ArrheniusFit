# ArrheniusFit
Fit material performance depends on time (month, day) and temperature.

## できること
材料の寿命予測を行います．

## 通常のアレニウスプロットの定式化
一般にアレニウスプロットを行うには，指標にする特性がある値まで低下するまでの期間を複数の温度で確認する必要があります．例えばゴムの質量変化を150, 200, 250°Cで観測を続け，質量が90%に減少するまで何日，何ヶ月かかったかを記録します．すると次の仮定の下で50°Cや100°Cで質量が90%になるのが何ヶ月後かを予測できます．

1. 材料特性が材料を構成する特定の化学物質の濃度に比例する
1. 化学物質の変化は1次反応の形で記述できる

例ではゴムの質量が材料特性です．また2の意味は触媒や大気中の酸素の濃度のように定数と見做せる化学種の関与を認めるということです．上記の仮定を式にすると次のようになります．

$$
\begin{cases}
\begin{align}
m &= v C \\
-\frac{dC}{dt} &= kC \\
k &= A \times exp(-E_a/RT)
\end{align}
\end{cases}
$$

ここで $m$ は特性， $v$ は比例定数， $C$ は化学物質のモル濃度， $t$ は時間， $k$ は反応速度定数です．また(3)式はアレニウスの式で， $A$ は頻度因子， $E_a$ は活性化エネルギー， $R$ は気体定数， $T$ は絶対温度です．上述の通り例えば大気の循環が十分な条件での酸素濃度[O<sub>2</sub>]は一定と見做せるので，(2)式で $k' = k[\textrm{O}_2]$ の置換をすれば純粋な1次反応と同様に扱えます．

さて(2)式の常微分方程式は簡単に解けて $C = C_0 e^{-kt}$ となります． $C_0$ は定数です．変数の依存関係を明示して(1)式に代入すると次の通りです．

$$m(t, T) = v C_0 e^{-k(T)t}$$

今，各温度において質量が90%に減少する時間が分かっているので，上記の式で比を取ると次のようになります．

$$m(t_{90}(T), T) / m(0, T) = e^{-k(T)t_{90}(T)} = 0.9$$

自然対数を取ってアレニウスの式を代入して整理します．

$$ -k(T)t_{90}(T) = ln 0.9 = -0.105$$

$$ -A \times exp(-E_a/RT) \times t_{90}(T) = -0.105$$

$$ exp(-E_a/RT) = 0.105/{A t_{90}(T)}$$

$$ -E_a/RT = ln(0.105) - ln (A) - ln(t_{90}(T))$$

$$ ln(t_{90}(T)) = E_a/RT + ln(0.105) - ln (A) $$

$$ ln(t_{90}(T)) = \alpha /T + \beta $$

最後の変形は定数を $\alpha, \beta$ にまとめました．この式を使って絶対温度 $T$ の逆数に対して特性が一定値に減少するまでの時間をプロットするのがアレニウスプロットです．

### 劣化量を固定しない方法

教科書的には特性が何%になるかを決めた上で実施するのがアレニウスプロットですが，開発段階で寿命の閾値を決められないことはあります．そのような場合にはとりあえず150, 200, 250°Cで1, 2, 3, 4週間後の特性変化を測定してみます．ただそうすると前述の方法で $t_{90}(T)$ が丁度得られるとは限りません．この場合は以下の重回帰式でやはり特性を予測できます．

$$ -ln \left( -ln \frac{m(t, T)}{m(0, T)} \right) = E_a/RT - ln (t) - ln (A) $$

特性が90%に低下するという項を $-ln (m(t, T)/m(0, T))$ に置換して整理しただけです．特性は低下するという暗黙の仮定によって $m(t, T)/m(0, T) < 1$ のため，これは正数になります．即ち左辺に実測した特性を使えばいいとなります．

### 特性と濃度の関係に定数項がある場合

この場合は初期値からの変化でなく，無限時間経過した時の理想値を使うことになります．
例えば樹脂に無機フィラーを充填した場合の質量減少は，無機フィラーの充填量という定数項を持ち，無限時間経過すればフィラーの質量になると期待されます．フィラーの質量を $F$ とすればコンパウンド全体の質量 $m$ は次の通りです．

$$ m(t, T) = v C_0 e^{-k(T)t} + F$$

 $F$ を移項します．

$$ m(t, T) - F = v C_0 e^{-k(T)t} $$

 $v$ は定数ですが，サンプルによってその値を変えるという意味では変数です．つまり準備したサンプルの大きさにバラツキがあれば変動します．この影響を排除するために $m(0, T) = v C_0 +F$ を変形した $v C_0 = m(0, T) - F$ で除算します．つまり劣化する樹脂の初期量 $M_0$ で割ります．

$$ \frac{m(t, T) - F}{m(0, T) - F} = e^{-k(T)t} $$

$$ \frac{m(t, T) - F}{M_0} = e^{-k(T)t} $$

左辺の分子は樹脂の残存量を表すので，結局は劣化する成分だけに着目すれば[定数項がない場合の方法](#通常のアレニウスプロットの定式化)に帰結します．

### 複数の成分が劣化する場合

[上記](#特性と濃度の関係に定数項がある場合)の通り変化する成分だけに注目すれば[特性が濃度に比例する場合](#通常のアレニウスプロットの定式化)の議論が使えます．複数成分を含む場合もそれぞれが単純に1次反応で劣化する場合はそれぞれの和で特性は予測できます．あえて式で書くと次の通りです．

$$ \sum_i m_i (t, T) = \sum_i e^{-k_i(T)t} $$

$$ \sum_i \left( m_i (t, T) - e^{-k_i(T)t} \right)= 0 $$

したがってフルコンパウンドの寿命予測には，フルコンパウンドの寿命データでなく，個別の材料のデータが必要です．

### 特性が濃度の冪乗に比例する場合

[定数項がある場合はない場合に帰結できる](#特性と濃度の関係に定数項がある場合)ので，冪乗成分だけを考えます．また低次の項は含まないと仮定します．

$$ m(t, T) = C^n = (v C_0 e^{-k(T)t})^n = (v C_0)^n e^{-nk(T)t}$$

これは初期値との比を取ると係数が消えます．

$$ \frac{m(t, T)}{m(0, T)} = e^{-nk(T)t}$$

この通り冪乗に比例する場合も $nA = A'$ の置換によって[1次の場合](#通常のアレニウスプロットの定式化)に帰結されます．

## アレニウスプロットの限界

前述の定式化において仮定が2つありました．劣化反応の1次性と特性の比例性です．後者は**無限時間後の劣化状態さえ分かれば**定数項を含んでもよく，冪乗であっても構いませんでした．では低次の項を含む場合や，前者の仮定についてはどうでしょうか？

### 特性が濃度の高次多項式で表される場合

特性は次のように表される．

$$ m(t, T) = \sum_n v_i C^n  = \sum_n v_n C_0^n e^{-nk(T)t}$$

残念ながら $m(0, T) $との比も差も係数や低次の項を消せないため，線形の回帰式を作ることはできません．

### 劣化が2次反応で進行する場合

#### 自己触媒型
例えば分解生成物が酸で，分解反応が酸によって触媒される場合が該当します．出発物質の濃度を $S$ ，分解生成物の濃度を $C$ とすると反応速度式は次のようになります．

$$ -\frac{dS}{dt} = \frac{dC}{dt} = kSC $$

左辺と中辺の微分方程式を解くと次の通りです．

$$ C = \alpha - S = C_0 + S_0 - S$$

 $\alpha$ は積分定数です．右辺では $S, C$ nの初期値 $S_0, C_0$ nを使って表現しました．これを元の反応速度式に代入します．

$$ -\frac{dS}{dt} = kS(C_0 + S_0 - S) = -kS^2 + k\alpha S$$

これはベルヌーイの微分方程式です． $z = S^{1-k}, k = 2$ と変数変換すると微分商は次のようになります．

$$ \frac{dz}{dt} = \frac{dz}{dS} \frac{dS}{dt} = (1-k)S^{-k} \frac{dS}{dt} $$

反応速度式の両辺に $(1-k)S^{-k} = -S^{-2}$ をかけます．

$$ -(1-k) S^{-k} \frac{dS}{dt} = k - k \alpha S^{-1}$$

変数変換して整理します．

$$ -\frac{dz}{dt} = k - k \alpha z$$

$$ \frac{dz}{k \alpha z - k} = dt $$

$$ \frac{1}{k \alpha} ln (k\alpha z - k) = t + \beta $$

$$ k \alpha z - k =  \beta' e^{k\alpha t} $$

$$ k \alpha z =  \beta' e^{k\alpha t} + k $$

$$ k \alpha / S =  \beta' e^{k\alpha t} + k $$

$$ S =  \frac{k\alpha}{\beta' e^{k\alpha t} + k}, C =  \frac{\alpha \beta' e^{k\alpha t}}{\beta' e^{k\alpha t} + k} $$

特性 $m$ は $S, C$ の和と仮定すると次のように書けます．

$$ m(t, T) = v_s S + v_c C = \frac{k v_s \alpha + v_c \alpha \beta' e^{k \alpha t}}{\beta' e^{k\alpha t} + k}$$

ここにアレニウスの式を代入しても，[1次反応の時](#通常のアレニウスプロットの定式化) のような $t, T (1/T)$ の線形の式は得られません．

#### 多段階型

$ S \longrightarrow P \xrightarrow{k_2} C $ の反応を考えます．逆反応は考えません．反応速度の連立方程式は次の通りです．

$$
\begin{cases}
\begin{align}
-\frac{dS}{dt} &= k_1 S \\
\frac{dP}{dt} &= -\frac{dS}{dt} - \frac{dC}{dt} \\
\frac{dC}{dt} &= k_2 P
\end{align}
\end{cases}
$$

(4)式が $ S $ の初期値を $ S_0 $ として $ S = S_0 e^{-k_1t} $ と解かれるのは[上記](#通常のアレニウスプロットの定式化)の通りです．これと(6)式を(5)式に代入して整理します．

$$
\frac{dP}{dt} = k_1 S_0 e^{-k_1t} - k_2 P
$$

$$ 
\frac{dP}{dt} + k_2 P = k_1 S_0 e^{-k_1t}
$$

両辺に $e^{k_2t}$ を掛けます．

$$ 
e^{k_2t} \frac{dP}{dt} + k_2 e^{k_2t} P = k_1 S_0 e^{(k_2 - k_1)t}
$$

すると左辺は積の微分です．

$$ 
\frac{d}{dt}(e^{k_2t}P) = k_1 S_0 e^{(k_2 - k_1)t}
$$

これも次のように解けます．

$$
\begin{split}
e^{k_2t}P &= \frac{k_1 S_0}{k_2 - k_1}e^{(k_2 - k_1)t} + \alpha \\
P &= \frac{k_1 S_0}{k_2 - k_1}e^{-k_1 t} + \alpha e^{-k_2 t} \\
&= \frac{k_1 S_0}{k_2 - k_1}e^{-k_1 t} + \alpha e^{-k_2 t} \\
&= \frac{k_1 S_0}{k_2 - k_1}e^{-k_1 t} + (P_0 - \frac{k_1 S_0}{k_2 - k_1}) e^{-k_2 t} \\
\end{split}
$$

ここで $P_0$ は $P$ の初期値です．成形時に劣化物が含まれなければ $P_0 = 0$ です．
最後に(6)式に代入します．

$$
\begin{alignedat}{3}
C &= &&(\frac{k_1 S_0}{k_2 - k_1} - P_0) e^{-k_2 t} - \frac{k_2 S_0}{k_2 - k_1} e^{-k_1 t} + \beta \\
&= &&(\frac{k_1 S_0}{k_2 - k_1} - P_0) e^{-k_2 t} - \frac{k_2 S_0}{k_2 - k_1} e^{-k_1 t} \\
& && + C_0 - (\frac{k_1 S_0}{k_2 - k_1} - P_0) + \frac{k_2 S_0}{k_2 - k_1} \\
\end{alignedat}
$$

さて全て解きましたが，残念ながら特性が $S$ 以外の寄与を受ける場合には[高次多項式の場合](#特性が濃度の高次多項式で表される場合)と同様に，それを線形の式で書くことはできません．